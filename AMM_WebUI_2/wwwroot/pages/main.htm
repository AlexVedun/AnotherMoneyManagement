<div id="main-div" class="col s12 m4 offset-m4 l4 offset-l4 xl4 offset-xl4">
    <h4>Кошельки и карты<br /> (всего: <!--ko text: mainSum()--><!--/ko--> грн.)</h4>
    <div class="row">
        <ul class="collection" data-bind="foreach: sourcesList">
            <li class="collection-item avatar">
                <div class="card-image" data-bind="if: Type.Name == 'Кошелек'">
                    <img class="circle" src="../../wwwroot/images/wallet.png" />
                </div>
                <div class="card-image" data-bind="if: Type.Name == 'Карта'">
                    <img class="circle" src="../../wwwroot/images/credit-card.png" />
                </div>
                <span class="title" data-bind="text: Name"></span>
                <p>Сумма: <!--ko text: Money--><!--/ko--> грн.</p>
                <p><!--ko text: Description--><!--/ko--></p>
                <!--<a href="#!" class="secondary-content"><i class="material-icons">edit</i></a>-->
                <!--<a class="secondary-content waves-effect waves-light btn-small"><i class="material-icons left">edit</i>Изменить</a>-->
                <button class="secondary-content waves-effect waves-light btn-small"
                        data-bind="click: $parent.EditSource"><i class="material-icons">edit</i></button>
            </li>            
        </ul>        
    </div>
    <div class="row">
        <a href="#!add_source" class="waves-effect waves-light btn"><i class="material-icons left">add</i>Добавить</a>
    </div>    
    <div class="fixed-action-btn">
        <a href="#!add_trans" class="btn-floating btn-large red waves-effect waves-light">
            <i class="large material-icons">add</i>
        </a>
        <!--<ul>
            <li><a class="btn-floating red"><i class="material-icons">insert_chart</i></a></li>
            <li><a class="btn-floating yellow darken-1"><i class="material-icons">format_quote</i></a></li>
            <li><a class="btn-floating green"><i class="material-icons">publish</i></a></li>
            <li><a class="btn-floating blue"><i class="material-icons">attach_file</i></a></li>
        </ul>-->
    </div>
    <!--<div class="card grey lighten-2">
        <div class="card-content">
            <span class="card-title">Вход</span>
            <div class="row">
                <form id="login-form">
                    <div class="row">
                        <div class="input-field col s12">
                            <input value="" id="UserLogin" name="Login" type="text" class="validate" data-bind="value: loginForm.Login">
                            <label class="active" for="UserLogin">Логин</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <input value="" id="UserPassword" name="Password" type="password" class="validate" data-bind="value: loginForm.Password">
                            <label class="active" for="UserPassword">Пароль</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="input-field col s12">
                            <label class="active"></label>
                        </div>
                    </div>
                    <div class="row">
                        <button class="col s12 m10 offset-m1 l10 offset-l1 xl10 offset-xl1 waves-effect waves-light btn"
                                data-bind="click: LoginClick">
                            Вход
                        </button>
                    </div>
                    <div class="row">
                        <button class="col s12 m10 offset-m1 l10 offset-l1 xl10 offset-xl1 waves-effect waves-light btn"
                                data-bind="click: ShowRegistrationClick">
                            Регистрация
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>-->
</div>
<script>    
    let AMM_MainViewModel = {
        self: this,
        sourcesList: ko.observableArray([]),
        mainSum: function () {
            let sum = 0;            
            for (let i = 0; i < this.sourcesList().length; i++) {
                sum += this.sourcesList()[i].Money;
            }            
            return sum;
        },
        //loginForm: {
        //    Login: ko.observable(""),
        //    Password: ko.observable("")
        //},
        EditSource: function () {

        },
        UpdateSourcesList: function () {
            AMM_ViewModel.showPreloader(true);
            $.ajax({
                url: "api/get-sources",                
                type: 'GET'
            }).done(function (resp) {
                console.log(resp);
                if (resp.error !== null && resp.error !== "") {
                    AMM_ViewModel.showPreloader(false);
                    alert(resp.error);
                }
                else {
                    AMM_ViewModel.showPreloader(false);
                    AMM_MainViewModel.sourcesList([]);
                    for (let item of resp.data) {
                        if (item.Type.Name === "Кошелек" || item.Type.Name === "Карта") {
                            AMM_MainViewModel.sourcesList.push(item);
                        }                        
                    }
                    //location.hash = "#!main";
                }
            }).fail(function (xhr, status, text) {
                AMM_ViewModel.showPreloader(false);
                alert("error: " + text);
            });
        }
        //LoginClick: function () {
        //    AMM_ViewModel.showPreloader(true);            
        //    let formData = ko.toJS(AMM_LoginViewModel.loginForm);
        //    console.log(formData);
        //    $.ajax({
        //        url: "api/login",
        //        data: formData,
        //        type: 'POST'
        //    }).done(function (resp) {
        //        console.log(resp);
        //        if (resp.error !== null && resp.error !== "") {
        //            AMM_ViewModel.showPreloader(false);
        //            alert(resp.error);
        //        }
        //        else {
        //            AMM_ViewModel.showPreloader(false);
        //            location.hash = "#!main";
        //        }
        //    }).fail(function (xhr, status, text) {
        //        AMM_ViewModel.showPreloader(false);
        //        alert("error: " + text);
        //    });
        //},

        //ShowRegistrationClick: function () {
        //    location.hash = "#!register";
        //}
    }    
    ko.applyBindings(AMM_MainViewModel, document.getElementById("main-div"));

    $(document).ready(function () {
        $('.fixed-action-btn').floatingActionButton();
    });

    AMM_MainViewModel.UpdateSourcesList();
</script>
